# 施設予約機能

Webアプリケーションに施設予約機能を追加しました！

## 🎯 機能概要

- **カレンダー表示**: 時間軸のタイムグリッドカレンダー（8:00～18:00）
- **既存予約の表示**: 赤色で表示され、選択不可
- **ドラッグ選択**: 空いている時間をマウスドラッグで選択
- **予約登録**: 選択した時間で予約を登録（コンソール出力）
- **視覚的なフィードバック**: 予約済み/選択中/予約可能を色分け表示

## 📱 使い方

### 1. 予約ページにアクセス

トップページの右上にある「➕ 新規予約」ボタンをクリック、または直接以下のURLにアクセス：

```
http://localhost:5000/booking
```

### 2. 施設と日付を選択

左サイドバーで：
1. **施設**: ドロップダウンから予約したい施設を選択
   - 社長室
   - 応接室
   - 事務室面談テーブル
   - 社員休憩室
   - 二階食堂
   
2. **日付**: カレンダーから日付を選択

3. **カレンダーを表示**: ボタンをクリック

### 3. 時間を選択

カレンダー上で：
- **赤色のブロック**: 既に予約済み（選択不可）
- **グレーの部分**: 予約可能（ホバーで青色に変化）
- **青色**: 現在選択中

**時間の選択方法**:
1. 開始時刻の時間帯をマウスでクリック
2. そのままドラッグして終了時刻まで移動
3. マウスを離すと選択完了

**ポイント**:
- 上から下へドラッグすることも、下から上へドラッグすることも可能
- 既存の予約がある時間帯は選択できません
- 選択をやり直したい場合は、再度ドラッグしてください

### 4. 予約情報を入力

左サイドバーの予約フォームに入力：

- **タイトル** (必須): 予定のタイトル
  - 例: 「営業会議」「打ち合わせ」「研修」
  
- **参加者** (任意): 参加者の名前をカンマ区切りで入力
  - 例: 「山田太郎, 鈴木花子, 佐藤次郎」

### 5. 予約を登録

「予約する」ボタンをクリック

→ コンソールに以下の情報が出力されます：

```
==================================================
新規予約登録
==================================================
施設: 社長室
日付: 2025-11-10
開始時刻: 10:00
終了時刻: 12:00
タイトル: 営業会議
参加者: 山田太郎, 鈴木花子
==================================================
```

→ 画面には「予約が登録されました（コンソールに出力）」と表示

## 🎨 カレンダーの見方

### 色分けの意味

| 色 | 意味 | 操作 |
|---|---|---|
| 🔴 赤色 | 予約済み | 選択不可 |
| 🔵 青色 | 選択中 | ドラッグで範囲変更可 |
| ⚪ グレー | 予約可能 | クリック/ドラッグで選択 |

### 既存予約の表示

既存の予約は赤いブロックとして表示され、以下の情報が含まれます：
- タイトル
- 開始時刻 - 終了時刻
- バッジ（来訪、会議、WEB会議など）

## 💡 使用例

### 例1: 午前中の会議室を予約

```
1. 施設: 応接室
2. 日付: 2025-11-10
3. 「カレンダーを表示」をクリック
4. 10:00から12:00をドラッグ選択
5. タイトル: 「営業会議」
6. 参加者: 「山田太郎, 鈴木花子」
7. 「予約する」をクリック
```

### 例2: 短時間の打ち合わせ

```
1. 施設: 事務室面談テーブル
2. 日付: 2025-11-11
3. 「カレンダーを表示」をクリック
4. 14:00から15:00を選択（1時間）
5. タイトル: 「進捗確認」
6. 参加者: 「佐藤次郎」
7. 「予約する」をクリック
```

### 例3: 終日利用

```
1. 施設: 二階食堂
2. 日付: 2025-11-15
3. 「カレンダーを表示」をクリック
4. 8:00から18:00まで全範囲をドラッグ
5. タイトル: 「全社会議」
6. 参加者: 「全社員」
7. 「予約する」をクリック
```

## 🔧 技術仕様

### 営業時間

- **開始**: 8:00
- **終了**: 18:00
- **表示単位**: 1時間

### 選択可能な時間

- 最小: 1時間（例: 10:00-11:00）
- 最大: 10時間（例: 8:00-18:00）
- 時間単位での選択のみ可能

### データ構造

予約データは以下の形式でコンソールに出力されます：

```json
{
  "facility": "社長室",
  "date": "2025-11-10",
  "start_time": "10:00",
  "end_time": "12:00",
  "title": "営業会議",
  "participants": ["山田太郎", "鈴木花子"]
}
```

## 🎯 今後の拡張案

現在はコンソールに出力するのみですが、以下の機能を追加可能：

1. **JSONファイルへの保存**
   - `schedule.json`に追記
   - IDの自動採番

2. **データベースへの保存**
   - SQLite/MySQL/PostgreSQL
   - トランザクション管理

3. **メール通知**
   - 予約確認メール
   - 参加者への通知

4. **予約の編集・削除**
   - 既存予約の修正
   - キャンセル機能

5. **承認フロー**
   - 予約申請と承認
   - 権限管理

6. **繰り返し予約**
   - 定期的な予約の一括登録
   - パターン設定

7. **30分単位の予約**
   - より細かい時間設定
   - タイムスロットの変更

## 🐛 トラブルシューティング

### カレンダーが表示されない

- 施設と日付が選択されているか確認
- ブラウザのコンソールでエラーを確認
- `schedule.json`が正しい形式か確認

### 時間を選択できない

- 赤色（予約済み）の時間は選択不可
- ブラウザのJavaScriptが有効か確認
- ページをリロードして再試行

### 予約ボタンが押せない

- タイトルが入力されているか確認
- 時間が選択されているか確認

## 📞 APIエンドポイント

### 予定取得

```
GET /api/events/<facility>/<date>
```

レスポンス:
```json
{
  "success": true,
  "events": [
    {
      "title": "会議",
      "start_time": "10:00",
      "end_time": "12:00",
      "badge": "会議",
      "participants": ["山田太郎"]
    }
  ]
}
```

### 予約登録

```
POST /api/book
Content-Type: application/json

{
  "facility": "社長室",
  "date": "2025-11-10",
  "start_time": "10:00",
  "end_time": "12:00",
  "title": "営業会議",
  "participants": ["山田太郎", "鈴木花子"]
}
```

レスポンス:
```json
{
  "success": true,
  "message": "予約が登録されました（コンソールに出力）"
}
```

## 🎨 カスタマイズ

### 営業時間の変更

`templates/booking.html`の以下の行を編集：

```javascript
// 営業時間の設定（8:00 ~ 18:00）
const START_HOUR = 8;   // 開始時刻
const END_HOUR = 18;    // 終了時刻
```

### 色の変更

`templates/booking.html`のCSSを編集：

```css
.time-slot.occupied {
    background: #ff6b6b;  /* 予約済みの色 */
}

.time-slot.selected {
    background: #4dabf7;  /* 選択中の色 */
}
```

## 📝 注意事項

- 現在は**コンソール出力のみ**で、実際のデータ保存は行われません
- 同時に複数のユーザーが予約する場合の競合制御は未実装
- 予約の重複チェックはクライアント側のみ（サーバー側の検証が必要）
- ログイン機能がないため、誰でも予約可能な状態です

