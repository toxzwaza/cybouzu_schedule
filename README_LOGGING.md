# ログ機能

`main.py`にログ記録機能を実装しました。追加、更新、削除などの操作がすべてログファイルに記録されます。

## 📝 ログファイル

### ファイル名形式

```
sync_log_YYYYMMDD_HHMMSS.log
```

例: `sync_log_20251105_143025.log`

### ファイルの場所

プロジェクトのルートディレクトリに保存されます：

```
D:\PYTHON\Cybouzu_schedule\sync_log_20251105_143025.log
```

## 📊 ログ出力の内容

### 1. **開始情報**

```
2025-11-05 14:30:25 - INFO - ============================================================
2025-11-05 14:30:25 - INFO - スケジュール同期処理を開始します
2025-11-05 14:30:25 - INFO - ログファイル: sync_log_20251105_143025.log
2025-11-05 14:30:25 - INFO - ============================================================
2025-11-05 14:30:26 - INFO - Cybozuにログイン中...
2025-11-05 14:30:28 - INFO - ログイン成功
2025-11-05 14:30:28 - INFO - 取得期間: 2025-11-05 ~ 約1ヶ月先まで (5週間)
2025-11-05 14:30:28 - INFO - 対象施設: 社長室, 応接室, 事務室面談テーブル, 社員休憩室, 二階食堂 (5施設)
2025-11-05 14:30:28 - INFO - 週表示のため、7日おきにアクセスします
```

### 2. **スケジュール同期操作**

#### 新規追加
```
2025-11-05 14:31:15 - INFO - [追加] 2025-11-10: 営業会議 (ID: 123, 10:00-12:00, 会議)
```

#### 更新
```
2025-11-05 14:31:16 - INFO - [更新] 2025-11-10: 営業会議 - 終了: 12:00 → 13:00
```

変更内容の詳細も記録：
- タイトル変更: `タイトル: 営業会議 → 営業定例会`
- 時間変更: `開始: 10:00 → 10:30`, `終了: 12:00 → 13:00`
- バッジ変更: `バッジ: 会議 → WEB会議`

#### 削除
```
2025-11-05 14:31:17 - WARNING - [削除] 2025-11-10: 打ち合わせ (ID: 45) - Cybozuから削除されました
```

#### 変更なし
```
2025-11-05 14:31:18 - DEBUG - [変更なし] 2025-11-10: 全社会議
```

### 3. **参加者情報取得**

```
2025-11-05 14:35:20 - INFO - ============================================================
2025-11-05 14:35:20 - INFO - 参加者情報を取得中...
2025-11-05 14:35:20 - INFO - ============================================================
2025-11-05 14:35:21 - INFO - 施設: 社長室
2025-11-05 14:35:22 - INFO -   2025-11-10: 営業会議 - 参加者: 3名
2025-11-05 14:35:23 - INFO -   2025-11-10: 全社会議 - 参加者: 15名
```

### 4. **完了統計**

```
2025-11-05 14:40:30 - INFO - 
2025-11-05 14:40:30 - INFO - ============================================================
2025-11-05 14:40:30 - INFO - 処理完了
2025-11-05 14:40:30 - INFO - ============================================================
2025-11-05 14:40:30 - INFO - 参加者情報: 45名を取得
2025-11-05 14:40:30 - INFO - ログファイル: sync_log_20251105_143025.log
2025-11-05 14:40:30 - INFO - ============================================================
```

### 5. **エラー・警告**

```
2025-11-05 14:32:10 - WARNING - 社長室のデータ構造が不正です。スキップします。
2025-11-05 14:32:15 - ERROR - 営業会議: 参加者取得エラー - Timeout waiting for element
```

## 🎯 ログレベル

| レベル | 用途 | 例 |
|--------|------|-----|
| **INFO** | 通常の操作 | 追加、更新、ログイン成功 |
| **WARNING** | 警告 | 削除検出、データ構造エラー |
| **ERROR** | エラー | 参加者取得失敗、接続エラー |
| **DEBUG** | デバッグ情報 | 変更なしの予定（※コンソールには表示されない） |

## 📖 ログの見方

### 例1: 新規予定が追加された

```log
2025-11-05 14:31:15 - INFO - [追加] 2025-11-10: 新規研修 (ID: 125, 14:00-16:00, 会議)
```

**読み方**:
- `2025-11-05 14:31:15` - 追加された日時
- `[追加]` - 操作の種類
- `2025-11-10` - 予定の日付
- `新規研修` - 予定のタイトル
- `ID: 125` - 割り当てられたID
- `14:00-16:00` - 時間
- `会議` - バッジ

### 例2: 予定が更新された

```log
2025-11-05 14:31:16 - INFO - [更新] 2025-11-10: 営業会議 - タイトル: 営業会議 → 営業定例会, 終了: 12:00 → 13:00
```

**読み方**:
- `[更新]` - 既存の予定が変更された
- `タイトル: 営業会議 → 営業定例会` - タイトルが変更
- `終了: 12:00 → 13:00` - 終了時刻が1時間延長

### 例3: 予定が削除された

```log
2025-11-05 14:31:17 - WARNING - [削除] 2025-11-10: 打ち合わせ (ID: 45) - Cybozuから削除されました
```

**読み方**:
- `WARNING` レベル - 削除は重要な操作
- `[削除]` - 予定が削除された
- `ID: 45` - 削除された予定のID
- `Cybozuから削除されました` - 削除の理由

## 🔍 ログの活用方法

### 1. **特定の日付の変更を確認**

```bash
findstr "2025-11-10" sync_log_20251105_143025.log
```

出力例:
```
2025-11-05 14:31:15 - INFO - [追加] 2025-11-10: 新規研修 (ID: 125, 14:00-16:00, 会議)
2025-11-05 14:31:16 - INFO - [更新] 2025-11-10: 営業会議 - 終了: 12:00 → 13:00
2025-11-05 14:31:17 - WARNING - [削除] 2025-11-10: 打ち合わせ (ID: 45) - Cybozuから削除されました
```

### 2. **追加された予定のみ確認**

```bash
findstr "[追加]" sync_log_20251105_143025.log
```

### 3. **更新された予定のみ確認**

```bash
findstr "[更新]" sync_log_20251105_143025.log
```

### 4. **削除された予定のみ確認**

```bash
findstr "[削除]" sync_log_20251105_143025.log
```

### 5. **エラーのみ確認**

```bash
findstr "ERROR" sync_log_20251105_143025.log
```

### 6. **特定の施設の変更を確認**

```bash
findstr "社長室" sync_log_20251105_143025.log
```

## 📈 統計情報の取得

### 追加された予定の数

```bash
findstr /C:"[追加]" sync_log_20251105_143025.log | find /C /V ""
```

### 更新された予定の数

```bash
findstr /C:"[更新]" sync_log_20251105_143025.log | find /C /V ""
```

### 削除された予定の数

```bash
findstr /C:"[削除]" sync_log_20251105_143025.log | find /C /V ""
```

## 💡 便利な使い方

### 実行時にログを確認

```bash
python main.py
```

ログはコンソールとファイルの両方に出力されるため、実行中の様子をリアルタイムで確認できます。

### 最新のログファイルを開く

```bash
# PowerShell
Get-ChildItem sync_log_*.log | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | notepad
```

### ログの保存期間

ログファイルは自動的には削除されません。定期的に古いログを整理してください：

```bash
# 30日以上古いログを削除（PowerShell）
Get-ChildItem sync_log_*.log | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-30)} | Remove-Item
```

## 📊 ログの構造

### タイムスタンプ形式

```
YYYY-MM-DD HH:MM:SS
```

例: `2025-11-05 14:30:25`

### ログレコードの構造

```
<タイムスタンプ> - <レベル> - <メッセージ>
```

例:
```
2025-11-05 14:30:25 - INFO - ログイン成功
```

### セパレータ

重要なセクションは以下の形式で区切られます：

```
============================================================
セクションタイトル
============================================================
```

または

```
========================================
施設: 社長室
========================================
```

## 🐛 トラブルシューティング

### ログファイルが作成されない

**原因**: 書き込み権限がない

**対処**:
```bash
# 管理者権限でコマンドプロンプトを開く
# または、別のディレクトリで実行
```

### ログファイルが大きくなりすぎる

**対処**: 定期的に古いログを削除するか、圧縮する

```bash
# 古いログを圧縮（PowerShell）
Compress-Archive -Path sync_log_*.log -DestinationPath logs_archive.zip
```

### 文字化けする

**原因**: エンコーディングの問題

**対処**: UTF-8対応のテキストエディタで開く
- VS Code
- Notepad++
- サクラエディタ

## 📝 ログ分析の例

### 日次レポートの作成

```python
# log_analyzer.py
import re
from datetime import datetime

log_file = 'sync_log_20251105_143025.log'

added = 0
updated = 0
deleted = 0

with open(log_file, 'r', encoding='utf-8') as f:
    for line in f:
        if '[追加]' in line:
            added += 1
        elif '[更新]' in line:
            updated += 1
        elif '[削除]' in line:
            deleted += 1

print(f'追加: {added}件')
print(f'更新: {updated}件')
print(f'削除: {deleted}件')
print(f'合計: {added + updated + deleted}件の変更')
```

## 🔒 セキュリティ

ログファイルには以下の情報が含まれます：
- 予定のタイトル
- 日時
- 参加者名
- URL（Cybozu内部のURL）

**注意**: ログファイルを外部に共有する際は、機密情報が含まれていないか確認してください。

## 📚 関連ドキュメント

- `README_SYNC.md` - 同期機能の詳細
- `README_WEBAPP.md` - Webアプリの使い方
- `README_BOOKING.md` - 予約機能の使い方

